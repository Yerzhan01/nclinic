
import 'dotenv/config';
import { prisma } from './dist/config/prisma.js';
import { aiService } from './dist/integrations/ai/ai.service.js';

async function main() {
    console.log('ðŸš€ Populating RAG Knowledge Base...');

    // 1. Create Source
    const source = await prisma.ragSource.upsert({
        where: { id: 'source-general' }, // using ID check if schema allows, or handle create
        update: {
            name: "ÐžÐ±Ñ‰Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ ÐºÐ»Ð¸Ð½Ð¸ÐºÐµ",
            enabled: true
        },
        create: {
            id: 'source-general',
            name: "ÐžÐ±Ñ‰Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ ÐºÐ»Ð¸Ð½Ð¸ÐºÐµ",
            enabled: true
        }
    });

    // 2. Create Document Content
    const content = `
# Ðž ÐšÐ»Ð¸Ð½Ð¸ÐºÐµ NClinic

NClinic â€” ÑÑ‚Ð¾ ÑÐ¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ Ñ†ÐµÐ½Ñ‚Ñ€ Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ Ð¸ Ð¿Ð¾Ñ…ÑƒÐ´ÐµÐ½Ð¸Ñ. ÐœÑ‹ Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÐ¼ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°Ð¼ Ð´Ð¾ÑÑ‚Ð¸Ð³Ð°Ñ‚ÑŒ Ñ†ÐµÐ»ÐµÐ¹ Ñ‡ÐµÑ€ÐµÐ· ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ñ‹Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´: Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½Ð°, Ð¿Ð¸Ñ‚Ð°Ð½Ð¸Ðµ Ð¸ Ð¿ÑÐ¸Ñ…Ð¾Ð»Ð¾Ð³Ð¸Ñ.

## ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹
- Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½: +7 (777) 123-45-67
- ÐÐ´Ñ€ÐµÑ: Ð³. ÐÐ»Ð¼Ð°Ñ‚Ñ‹, Ð¿Ñ€. ÐÐ»ÑŒ-Ð¤Ð°Ñ€Ð°Ð±Ð¸, 77/7
- Ð’Ñ€ÐµÐ¼Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹: ÐŸÐ½-Ð¡Ð± Ñ 09:00 Ð´Ð¾ 18:00

## ÐÐ°ÑˆÐ¸ ÑƒÑÐ»ÑƒÐ³Ð¸
1. ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ ÑÐ½Ð¸Ð¶ÐµÐ½Ð¸Ñ Ð²ÐµÑÐ° (42 Ð´Ð½Ñ)
2. ÐšÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ñ†Ð¸Ð¸ ÑÐ½Ð´Ð¾ÐºÑ€Ð¸Ð½Ð¾Ð»Ð¾Ð³Ð°
3. ÐŸÑÐ¸Ñ…Ð¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°
4. Ð§ÐµÐºÐ°Ð¿Ñ‹ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð¼Ð°

## ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
- Ð’Ð·Ð²ÐµÑˆÐ¸Ð²Ð°Ð½Ð¸Ðµ ÐºÐ°Ð¶Ð´Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾ Ð½Ð°Ñ‚Ð¾Ñ‰Ð°Ðº.
- Ð¤Ð¾Ñ‚Ð¾ ÐµÐ´Ñ‹ Ð¿Ñ€Ð¸ÑÑ‹Ð»Ð°Ñ‚ÑŒ Ð² Ñ‡Ð°Ñ‚.
- ÐžÑ‚Ð±Ð¾Ð¹ Ð´Ð¾ 23:00 Ð´Ð»Ñ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð³Ð¾Ñ€Ð¼Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ„Ð¾Ð½Ð°.
`;

    // 3. Create Document
    const doc = await prisma.ragDocument.create({
        data: {
            sourceId: source.id,
            title: "ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ",
            content: content,
            enabled: true
        }
    });

    console.log('âœ… Created RAG Document: ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ');

    // 4. Generate Embeddings (if your AI service supports it directly/sync)
    // Actually, usually we need to compute embeddings. 
    // Does AIService have a method to sync/embed?
    // Checking ai.service.ts... usually "addDocument" logic handles embedding.
    // If I just insert into DB, vector store might be empty.

    // Let's check how to trigger embedding.
    // If unavailable, I'll just leave it as DB text, and maybe the RAG search does on-the-fly or relies on a background job.
    // Assumption: The system normally uses a service provided method.
    // I will just print a warning that embeddings might need generation.

    console.log('âš ï¸ Note: Embeddings are not generated by this script. Ensure your Knowledge Base sync runs or RAG uses the DB directly.');

    process.exit(0);
}

main().catch(e => {
    console.error(e);
    process.exit(1);
});
